name: Verificar JavaFX (frontend) al hacer PR ‚Üí frontend

on:
  pull_request:
    branches: [ frontend ]

jobs:
  build-and-ui-smoketest:
    runs-on: ubuntu-latest

    steps:
      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      # 1) Checkout
      - name: Checkout repository
        uses: actions/checkout@v3

      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      # 2) Java & Maven cache
      - name: Setup Temurin 21 + Maven cache
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: 21
          cache: maven

      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      # 3) Build & unit tests
      - name: Build frontend (+tests)
        run: mvn -B -f analizador-frontend/pom.xml clean verify

      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      # 4) Package ‚Äúfat jar‚Äù  (ajusta el goal si usas javafx-maven-plugin)
      - name: Package runnable jar
        run: mvn -B -f analizador-frontend/pom.xml package -DskipTests

      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      # 5) Instalar & arrancar Xvfb
      - name: Install Xvfb
        run: |
          sudo apt-get update -y
          sudo apt-get install -y xvfb

      # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
      # 6) Smoke-test de la GUI
      #
      #   Damos 15 s; si la app crashea ‚Üí c√≥digo ‚â†0 ‚áí job falla
      #   Si la app sigue viva pasados los 15 s, la matamos y
      #     consideramos que la inicializaci√≥n fue correcta.
      - name: Launch JavaFX
        env:
          DISPLAY: ":99"
        run: |
          set -e  # aborta si alg√∫n comando devuelve ‚â†0
          # 6.1 Arrancar servidor X virtual
          Xvfb :99 -screen 0 1280x720x24 &
          XVFB_PID=$!
          # 6.2 Lanzar aplicaci√≥n (elige una de las dos formas)
          # ‚Äî Opci√≥n A ‚Äî jar ‚Äúfat‚Äù generado en target:
          java -jar analizador-frontend/target/analizador-frontend.jar &
          APP_PID=$!
          
#          # ‚Äî Opci√≥n B ‚Äî con el plugin JavaFX:
#          # mvn -q -f analizador-frontend/pom.xml javafx:run &
#          # APP_PID=$!
#
#          # 6.3 Esperamos 15 s‚Ä¶
#          sleep 15
#
#          # 6.4 ¬øSigue viva la JVM?
#          if ps -p $APP_PID > /dev/null ; then
#            echo "üéâ La GUI se inici√≥ correctamente (PID $APP_PID)."
#            kill $APP_PID
#          else
#            echo "‚ùå La aplicaci√≥n JavaFX termin√≥ prematuramente."
#            kill $XVFB_PID      # limpiamos
#            exit 1
#          fi
#
#           6.5 Todo OK; cerramos Xvfb
#          kill $XVFB_PID
